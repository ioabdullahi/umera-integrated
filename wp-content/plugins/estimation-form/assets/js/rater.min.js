(function(b,l){function e(a,c){this.element=a;this.settings=b.extend({},b.fn.rate.settings,c);this.set_faces={};this.build()}b.fn.textWidth=function(){var a=b("<span>"+b(this).html()+"</span>");a.css("font-size",b(this).css("font-size")).hide();a.prependTo("body");var c=a.width();a.remove();if(0==c){var d=0;b(this).eq(0).children().each(function(){d+=b(this).textWidth()});return d}return c};b.fn.textHeight=function(){var a=b("<span>"+b(this).html()+"</span>");a.css("font-size",b(this).css("font-size")).hide();
a.prependTo("body");var c=a.height();a.remove();return c};Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};String.prototype.getCodePointLength=function(){return this.length-this.split(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g).length+1};String.fromCodePoint=function(){for(var a=Array.prototype.slice.call(arguments),b=a.length;0<b--;){var d=a[b]-65536;0<=d&&a.splice(b,1,55296+(d>>10),56320+(d&1023))}return String.fromCharCode.apply(null,a)};b.fn.rate=function(a){if(void 0===
a||"object"===typeof a)return this.each(function(){b.data(this,"rate")||b.data(this,"rate",new e(this,a))});if("string"===typeof a){var c=arguments,d;this.each(function(){var f=b.data(this,"rate");f instanceof e&&"function"===typeof f[a]&&(d=f[a].apply(f,Array.prototype.slice.call(c,1)));"destroy"===a&&(b(f.element).off(),b.data(this,"rate",null))});return void 0!==d?d:this}};e.prototype.build=function(){this.layers={};this.value=0;this.raise_select_layer=!1;this.settings.initial_value&&(this.value=
this.settings.initial_value);b(this.element).attr("data-rate-value")&&(this.value=b(this.element).attr("data-rate-value"));var a=this.value/this.settings.max_value*100;if("string"===typeof this.settings.symbols[this.settings.selected_symbol_type]){var c=this.settings.symbols[this.settings.selected_symbol_type];this.settings.symbols[this.settings.selected_symbol_type]={};this.settings.symbols[this.settings.selected_symbol_type].base=c;this.settings.symbols[this.settings.selected_symbol_type].selected=
c;this.settings.symbols[this.settings.selected_symbol_type].hover=c}c=this.addLayer("base-layer",100,this.settings.symbols[this.settings.selected_symbol_type].base,!0);a=this.addLayer("select-layer",a,this.settings.symbols[this.settings.selected_symbol_type].selected,!0);var d=this.addLayer("hover-layer",0,this.settings.symbols[this.settings.selected_symbol_type].hover,!1);this.layers.base_layer=c;this.layers.select_layer=a;this.layers.hover_layer=d;b(this.element).on("mousemove",b.proxy(this.hover,
this));b(this.element).on("click",b.proxy(this.select,this));b(this.element).on("mouseleave",b.proxy(this.mouseout,this));b(this.element).css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"});this.settings.hasOwnProperty("update_input_field_name")&&this.settings.update_input_field_name.val(this.value)};e.prototype.addLayer=function(a,c,d,e){for(var f="<div>",g=0;g<this.settings.max_value;g++)Array.isArray(d)?
(this.settings.convert_to_utf8&&(d[g]=String.fromCodePoint(d[g])),f+="<span>"+d[g]+"</span>"):(this.settings.convert_to_utf8&&(d=String.fromCodePoint(d)),f+="<span>"+d+"</span>");a=b(f+"</div>").addClass("rate-"+a).appendTo(this.element);b(a).css({width:c+"%",height:b(a).children().eq(0).textHeight(),overflow:"hidden",position:"absolute",top:0,display:e?"block":"none","white-space":"nowrap"});b(this.element).css({width:b(a).textWidth()+"px",height:b(a).height(),position:"relative",cursor:this.settings.cursor});
return a};e.prototype.updateServer=function(){void 0!=this.settings.url&&b.ajax({url:this.settings.url,type:this.settings.ajax_method,data:b.extend({},{value:this.getValue()},this.settings.additional_data),success:b.proxy(function(a){b(this.element).trigger("updateSuccess",[a])},this),error:b.proxy(function(a,c,d){b(this.element).trigger("updateError",[a,c,d])},this)})};e.prototype.getValue=function(){return this.value};e.prototype.hover=function(a){var c=parseInt(b(this.element).css("padding-left").replace("px",
""));a=a.pageX-b(this.element).offset().left-c;a=this.toValue(a,!0);a!=this.value&&(this.raise_select_layer=!1);this.raise_select_layer||this.settings.readonly||(c=this.toWidth(a),this.layers.select_layer.css({display:"none"}),this.settings.only_select_one_symbol?(a=Math.floor(a),this.layers.hover_layer.css({width:"100%",display:"block"}),this.layers.hover_layer.children("span").css({visibility:"hidden"}),this.layers.hover_layer.children("span").eq(0!=a?a-1:0).css({visibility:"visible"})):this.layers.hover_layer.css({width:c+
"%",display:"block"}))};e.prototype.select=function(a){if(!this.settings.readonly){this.getValue();var c=parseInt(b(this.element).css("padding-left").replace("px",""));a=a.pageX-b(this.element).offset().left-c;a=this.toWidth(this.toValue(a,!0));this.setValue(this.toValue(a));this.raise_select_layer=!0}};e.prototype.mouseout=function(){this.layers.hover_layer.css({display:"none"});this.layers.select_layer.css({display:"block"})};e.prototype.toWidth=function(a){return a/this.settings.max_value*100};
e.prototype.toValue=function(a,b){a=b?a/this.layers.base_layer.textWidth()*this.settings.max_value:a/100*this.settings.max_value;b=a/this.settings.step_size;5E-5>b-Math.floor(b)&&(a=Math.round(a/this.settings.step_size)*this.settings.step_size);a=Math.ceil(a/this.settings.step_size)*this.settings.step_size;return a=a>this.settings.max_value?this.settings.max_value:a};e.prototype.getElement=function(a,c){return b(this.element).find(".rate-"+a+" span").eq(c-1)};e.prototype.getLayers=function(){return this.layers};
e.prototype.setFace=function(a,b){this.set_faces[a]=b};e.prototype.setAdditionalData=function(a){this.settings.additional_data=a};e.prototype.getAdditionalData=function(){return this.settings.additional_data};e.prototype.removeFace=function(a){delete this.set_faces[a]};e.prototype.setValue=function(a){if(!this.settings.readonly){0>a?a=0:a>this.settings.max_value&&(a=this.settings.max_value);var c=this.getValue();this.value=a;b(this.element).trigger("change",{from:c,to:this.value});b(this.element).find(".rate-face").remove();
b(this.element).find("span").css({visibility:"visible"});a=Math.ceil(this.value);if(this.set_faces.hasOwnProperty(a)){var d="<div>"+this.set_faces[a]+"</div>",e=this.getElement("base-layer",a),h=this.getElement("select-layer",a),g=this.getElement("hover-layer",a),k=e.textWidth()*(a-1)+(e.textWidth()-b(d).textWidth())/2;b(d).appendTo(this.element).css({display:"inline-block",position:"absolute",left:k}).addClass("rate-face");e.css({visibility:"hidden"});h.css({visibility:"hidden"});g.css({visibility:"hidden"})}this.settings.only_select_one_symbol?
(d=this.toWidth(this.settings.max_value),this.layers.select_layer.css({display:"block",width:d+"%",height:this.layers.base_layer.css("height")}),this.layers.hover_layer.css({display:"none",height:this.layers.base_layer.css("height")}),this.layers.select_layer.children("span").css({visibility:"hidden"}),this.layers.select_layer.children("span").eq(0!=a?a-1:0).css({visibility:"visible"})):(d=this.toWidth(this.value),this.layers.select_layer.css({display:"block",width:d+"%",height:this.layers.base_layer.css("height")}),
this.layers.hover_layer.css({display:"none",height:this.layers.base_layer.css("height")}));b(this.element).attr("data-rate-value",this.value);this.settings.change_once&&(this.settings.readonly=!0);this.updateServer();b(this.element).trigger("afterChange",{from:c,to:this.value});this.settings.hasOwnProperty("update_input_field_name")&&this.settings.update_input_field_name.val(this.value)}};e.prototype.increment=function(){this.setValue(this.getValue()+this.settings.step_size)};e.prototype.decrement=
function(){this.setValue(this.getValue()-this.settings.step_size)};b.fn.rate.settings={max_value:5,step_size:.5,initial_value:0,symbols:{utf8_star:{base:"\u2606",hover:"\u2605",selected:"\u2605"},utf8_hexagon:{base:"\u2b21",hover:"\u2b22",selected:"\u2b22"},hearts:"&hearts;",fontawesome_beer:'<i class="fa fa-beer"></i>',fontawesome_star:{base:'<i class="fa fa-star-o"></i>',hover:'<i class="fa fa-star"></i>',selected:'<i class="fa fa-star"></i>'},utf8_emoticons:{base:[128549,128531,128530,128516],
hover:[128549,128531,128530,128516],selected:[128549,128531,128530,128516]}},selected_symbol_type:"utf8_star",convert_to_utf8:!1,cursor:"default",readonly:!1,change_once:!1,only_select_one_symbol:!1,ajax_method:"POST",additional_data:{}}})(jQuery,window);